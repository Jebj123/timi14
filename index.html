<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tími 14</title>
  </head>
  <body>
    <section>
      <h2>Æfing 1: Sækja notendur (users) og birta lista af nöfnum þeirra</h2>
      <ul id="user-list"></ul>
      <script>
        fetch("https://jsonplaceholder.typicode.com/users")
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((users) => {
            // Prenta í console til að sjá uppsetninguna á gögnum
            console.log("users", users);

            const userList = document.getElementById("user-list");
            users.forEach((user) => {
              const li = document.createElement("li");
              li.textContent = user.name;
              userList.appendChild(li);
            });
          })
          .catch((error) => {
            // ef að url er rangt. Þá mun response ekki vera ok
            // og það mun fara í catch því við erum að throw error
            // það sem kemur inn í throw error birtist í console í inspect
            console.error("Villa", error);
          });
      </script>
    </section>
    <section>
      <h2>
        Æfing 2: Sækja notendur með async/await og birta lista af símanúmerum
      </h2>
      <ul id="user-list-async"></ul>
      <script>
        async function getUsersAsync() {
          const response = await fetch(
            "https://jsonplaceholder.typicode.com/users"
          );
          const users = await response.json();
          console.log("Users in async", users);

          const usersList = document.getElementById("user-list-async");
          users.forEach((user) => {
            const li = document.createElement("li");
            li.textContent = user.phone;
            usersList.appendChild(li);
          });
        }
        getUsersAsync();
      </script>
    </section>
    <section>
      <h2>Æfing 3: Skrifa rangt URL til að prófa villumeðhöndlun</h2>
      <p id="status-invalid-url"></p>
      <script>
        async function testInvalidUrl() {
          const statusInvalidUrl =
            document.getElementById("status-invalid-url");
          try {
            const response = await fetch(
              "https://jsonplaceholder.typicode.com/invalid-url"
            );
            if (!response.ok) {
              throw new Error(`HTTP villa: ${response.status}`);
            }
            // Ef við tökum if út þá mun línan fyrir neðan birtast því við erum ekki að kasta villu
            statusInvalidUrl.textContent =
              "Gögnin hlaðin án villu(átti ekki að gerast)";
            return response.json();
          } catch {
            statusInvalidUrl.textContent = "Villa við að hlaða gögnum";
            console.error("Villa kom upp", error);
          }
        }
        testInvalidUrl();
      </script>
    </section>
    <section>
      <h2>Æfing 4: Bæta við "hleð gögn..." skilaboð</h2>
      <ul id="user-list-loading"></ul>
      <p id="loading"></p>
      <script>
        function getUsersWithStatus() {
          const userListLoading = document.getElementById("user-list-loading");
          const loadingText = document.getElementById("loading");

          loadingText.textContent = "Hleð gögnum...";
          setTimeout(() => {
            fetch("https://jsonplaceholder.typicode.com/users")
              .then((response) => response.json())
              .then((users) => {
                users.forEach((user) => {
                  const li = document.createElement("li");
                  li.textContent = user.company.name;
                  userListLoading.appendChild(li);
                });
                loadingText.textContent = "";
              })
              .catch((error) => {
                console.error("villa:", error);
                loadingText.textContent = "Villa kom upp!";
              });
          }, 2000);
        }
        getUsersWithStatus();
      </script>
    </section>
  </body>
</html>
